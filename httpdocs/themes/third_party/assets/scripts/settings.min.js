(function(e){if(typeof window.Assets=="undefined"){window.Assets={}}Assets.onAllFiledirsChange=function(k){var l=e(k),j=!!l.attr("checked"),m=e("input",l.parent().parent().next());m.attr({checked:j,disabled:j})};e(".assets-view").each(function(){var k=e(".assets-view-thumbs",this),j=e(".assets-view-list",this),l=e(this).parent().parent().next().hide();k.change(function(){l.hide()});j.change(function(){l.show()})});e("form#source_form").keydown(function(k){var j=(k.which)?k.which:event.keyCode;if(j==13){k.stopPropagation();e(this).find("input:last").click()}}).submit(function(j){if(e("input#source_name").val().length<1){j.preventDefault()}});var h=e();function d(){var j=h.find(":selected");e("#s3_bucket_location").val(j.attr("data-location"));e("#s3_bucket_url_prefix").val(j.attr("data-url-prefix"))}e(".refresh_buckets").live("click",function(k){k.preventDefault();var l={ACT:Assets.actions.get_s3_buckets};e("input.setting_field[data-type=s3]").each(function(){l[e(this).prop("name")]=e(this).val()});var j=e(this).parent().find("select").val();e("#s3_buckets").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,l,function(m){e("#s3_buckets").html(m);h=e("#s3_buckets > select");h.change(d);if(j){h.val(j);if(h.val()!=j){d()}}else{d()}})});var a=e();function c(){var j=a.find(":selected");e("#gc_bucket_url_prefix").val(j.attr("data-url-prefix"))}e(".refresh_gc_buckets").live("click",function(k){k.preventDefault();var l={ACT:Assets.actions.get_gc_buckets};e("input.setting_field[data-type=gc]").each(function(){l[e(this).prop("name")]=e(this).val()});var j=e(this).parent().find("select").val();e("#gc_buckets").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,l,function(m){e("#gc_buckets").html(m);a=e("#gc_buckets > select");a.change(c);if(j){a.val(j);if(a.val()!=j){c()}}else{c()}})});e(".refresh_regions").live("click",function(k){k.preventDefault();var l={ACT:Assets.actions.get_rs_regions};e("input.setting_field[data-type=rs], select.setting_field[data-type=rs]").each(function(){l[e(this).prop("name")]=e(this).val()});var j=e(this).parent().find("select").val();e("#rs_regions").html('<div class="assets-loading"></div>');e.post(Assets.siteUrl,l,function(m){e("#rs_regions").html(m);if(j){e("#rs_regions").find("select").val(j)}})});var b=e();function g(){var j=b.find(":selected");e("#rs_container_url_prefix").val(j.attr("data-url-prefix"))}e(".refresh_containers").live("click",function(k){k.preventDefault();if(!e("#rs_regions select").val()){alert(Assets.lang.rs_select_region);return}var l={ACT:Assets.actions.get_rs_containers};e("input.setting_field[data-type=rs], select.setting_field[data-type=rs]").each(function(){l[e(this).prop("name")]=e(this).val()});l.rs_region=e("#rs_regions select").val();e("#rs_containers").html('<div class="assets-loading"></div>');var j=e(this).parent().find("select").val();e.post(Assets.siteUrl,l,function(m){e("#rs_containers").html(m);b=e("#rs_containers > select");b.change(g);if(j){b.val(j);if(b.val()!=j){g()}}else{g()}})});e(".delete_source").click(function(){var j=e(this).attr("data-source-name");if(confirm(Assets.lang.confirm_delete_source.replace("{source}",j))){var k=e(this).attr("data-source-id");e("#source_id").val(k);e("form#delete_source").submit()}});var f=e("select#source_type");var i=f.val();e(".asset-source-settings[data-type="+i+"]").show();f.change(function(){e(".asset-source-settings").hide().filter("[data-type="+e(this).val()+"]").show()});e("input.assets-index").click(function(){var k=e(this);if(k.hasClass("disabled")){return}k.addClass("disabled");var j=e("input.indexing:checked");e("div#assets-dialog div#index-status-report").empty();e("div#assets-dialog div#index-message").empty();if(j.length>0){e.post(Assets.siteUrl,{ACT:Assets.actions.get_session_id},function(n){n=e.evalJSON(n);var o=n.session;var m=[];var l=new Assets.AjaxQueueManager(10,function(){e("input.assets-index.disabled").removeClass("disabled");e("div.progress-bar").remove();var p=[];j.each(function(){p.push(e(this).attr("id"))});var q={ACT:Assets.actions.finish_index,session:o,command:e.toJSON({command:"statistics"}),sources:p.join(",")};e.post(Assets.siteUrl,q,function(u){u=e.evalJSON(u);if(m.length>0||typeof u.files!="undefined"){e("div#assets-dialog div#index-message").html(Assets.lang.index_stale_entries_message);var s="";if(m.length>0){s+='<div class="index-data-container"><strong>'+Assets.lang.index_folders+"</strong>";for(var r=0;r<m.length;r++){s+='<div><label><input type="checkbox" checked="checked" class="delete_folder" value="'+m[r].folder_id+'" /> '+m[r].folder_name+"</label></div>"}s+="</div>"}if(typeof u.files!="undefined"){s+='<div class="index-data-container"><strong>'+Assets.lang.index_files+"</strong>";for(var t in u.files){s+='<div><label><input type="checkbox" checked="checked" class="delete_file" value="'+t+'" /> '+u.files[t]+"</label></div>"}s+="</div>"}s+='<br /><input type="button" class="submit" value="'+Assets.lang._delete+'" onclick="deleteSelectedFiles();"/>';e("#index-status-report").empty().append(s)}else{e("div#assets-dialog div#index-status-report").empty();e("div#index-message").html(Assets.lang.index_complete)}e("div#assets-dialog").show()})});j.each(function(){e(this).parent().find(".progress-bar").remove().end().append('<div class="progress-bar"><div class="progress-filler"></div></div>');var p=e(this).siblings(".progress-bar");var q={ACT:Assets.actions.start_index,source:e(this).attr("id"),session:o};l.addItem(Assets.siteUrl,q,function(t){t=e.evalJSON(t);if(t.error){alert(t.error);return}p.attr("total",t.total).attr("current",0);for(var s=0;s<t.total;s++){q={ACT:Assets.actions.perform_index,session:o,source_type:t.source_type,source_id:t.source_id,offset:s};l.addItem(Assets.siteUrl,q,function(){var v=parseInt(p.attr("current"),10);p.attr("current",++v);var u=Math.min(Math.ceil(100/p.attr("total")*v),100)+"%";p.find(".progress-filler").stop().animate({width:u},70,"linear")})}for(var r in t.missing_folders){m.push({folder_id:r,folder_name:t.missing_folders[r]})}})});l.startQueue()})}else{k.removeClass("disabled")}})})(jQuery);function deleteSelectedFiles(){var b={};b.command="delete";b.folder_ids=[];b.file_ids=[];$("div#assets-dialog input.delete_folder:checked").each(function(){b.folder_ids.push($(this).val())});$("div#assets-dialog input.delete_file:checked").each(function(){b.file_ids.push($(this).val())});var a={ACT:Assets.actions.finish_index,command:$.toJSON(b)};$.post(Assets.siteUrl,a,function(){$("div#assets-dialog div#index-status-report").empty();$("#index-message").html(Assets.lang.index_complete)})};